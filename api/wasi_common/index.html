<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The `WasiFile` and `WasiDir` traits"><meta name="keywords" content="rust, rustlang, rust-lang, wasi_common"><title>wasi_common - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../wasi_common/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class="location">Crate wasi_common</p><div class="block version"><p>Version 0.28.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all wasi_common's items</p></a><div class="block items"><ul><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></div><p class="location"></p><div id="sidebar-vars" data-name="wasi_common" data-ty="mod" data-relpath="../"></div></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="">wasi_common</a><button id="copy-path" onclick="copy_path(this)">⎘</button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/wasi_common/lib.rs.html#1-73" title="goto source code">[src]</a></span></h1><div class="docblock"><h2 id="the-wasifile-and-wasidir-traits" class="section-header"><a href="#the-wasifile-and-wasidir-traits">The <code>WasiFile</code> and <code>WasiDir</code> traits</a></h2>
<p>The WASI specification only defines one <code>handle</code> type, <code>fd</code>, on which all
operations on both files and directories (aka dirfds) are defined. We
believe this is a design mistake, and are architecting wasi-common to make
this straightforward to correct in future snapshots of WASI.  Wasi-common
internally treats files and directories as two distinct resource types in
the table - <code>Box&lt;dyn WasiFile&gt;</code> and <code>Box&lt;dyn WasiDir&gt;</code>. The snapshot 0 and
1 interfaces via <code>fd</code> will attempt to downcast a table element to one or
both of these interfaces depending on what is appropriate - e.g.
<code>fd_close</code> operates on both files and directories, <code>fd_read</code> only operates
on files, and <code>fd_readdir</code> only operates on directories.
The <code>WasiFile</code> and <code>WasiDir</code> traits are defined by <code>wasi-common</code> in terms
of types defined directly in the crate’s source code (I decided it should
NOT those generated by the <code>wiggle</code> proc macros, see snapshot architecture
below), as well as the <code>cap_std::time</code> family of types.  And, importantly,
<code>wasi-common</code> itself provides no implementation of <code>WasiDir</code>, and only two
trivial implementations of <code>WasiFile</code> on the <code>crate::pipe::{ReadPipe, WritePipe}</code> types, which in turn just delegate to <code>std::io::{Read, Write}</code>. In order for <code>wasi-common</code> to access the local filesystem at all,
you need to provide <code>WasiFile</code> and <code>WasiDir</code> impls through either the new
<code>wasi-cap-std-sync</code> crate found at <code>crates/wasi-common/cap-std-sync</code> - see
the section on that crate below - or by providing your own implementation
from elsewhere.</p>
<p>This design makes it possible for <code>wasi-common</code> embedders to statically
reason about access to the local filesystem by examining what impls are
linked into an application. We found that this separation of concerns also
makes it pretty enjoyable to write alternative implementations, e.g. a
virtual filesystem (which will land in a future PR).</p>
<h2 id="traits-for-the-rest-of-wasis-features" class="section-header"><a href="#traits-for-the-rest-of-wasis-features">Traits for the rest of WASI’s features</a></h2>
<p>Other aspects of a WASI implementation are not yet considered resources
and accessed by <code>handle</code>. We plan to correct this design deficiency in
WASI in the future, but for now we have designed the following traits to
provide embedders with the same sort of implementation flexibility they
get with WasiFile/WasiDir:</p>
<ul>
<li>Timekeeping: <code>WasiSystemClock</code> and <code>WasiMonotonicClock</code> provide the two
interfaces for a clock. <code>WasiSystemClock</code> represents time as a
<code>cap_std::time::SystemTime</code>, and <code>WasiMonotonicClock</code> represents time as
<code>cap_std::time::Instant</code>.  * Randomness: we re-use the <code>cap_rand::RngCore</code>
trait to represent a randomness source. A trivial <code>Deterministic</code> impl is
provided.  * Scheduling: The <code>WasiSched</code> trait abstracts over the
<code>sched_yield</code> and <code>poll_oneoff</code> functions.</li>
</ul>
<p>Users can provide implementations of each of these interfaces to the
<code>WasiCtx::builder(...)</code> function. The
<code>wasi_cap_std_sync::WasiCtxBuilder::new()</code> function uses this public
interface to plug in its own implementations of each of these resources.</p>
</div><h2 id="reexports" class="section-header"><a href="#reexports">Re-exports</a></h2>
<table><tr><td><code>pub use clocks::<a class="enum" href="../wasi_common/clocks/enum.SystemTimeSpec.html" title="enum wasi_common::clocks::SystemTimeSpec">SystemTimeSpec</a>;</code></td></tr><tr><td><code>pub use clocks::<a class="struct" href="../wasi_common/clocks/struct.WasiClocks.html" title="struct wasi_common::clocks::WasiClocks">WasiClocks</a>;</code></td></tr><tr><td><code>pub use clocks::<a class="trait" href="../wasi_common/clocks/trait.WasiMonotonicClock.html" title="trait wasi_common::clocks::WasiMonotonicClock">WasiMonotonicClock</a>;</code></td></tr><tr><td><code>pub use clocks::<a class="trait" href="../wasi_common/clocks/trait.WasiSystemClock.html" title="trait wasi_common::clocks::WasiSystemClock">WasiSystemClock</a>;</code></td></tr><tr><td><code>pub use dir::<a class="trait" href="../wasi_common/dir/trait.WasiDir.html" title="trait wasi_common::dir::WasiDir">WasiDir</a>;</code></td></tr><tr><td><code>pub use file::<a class="trait" href="../wasi_common/file/trait.WasiFile.html" title="trait wasi_common::file::WasiFile">WasiFile</a>;</code></td></tr><tr><td><code>pub use sched::<a class="struct" href="../wasi_common/sched/struct.Poll.html" title="struct wasi_common::sched::Poll">Poll</a>;</code></td></tr><tr><td><code>pub use sched::<a class="trait" href="../wasi_common/sched/trait.WasiSched.html" title="trait wasi_common::sched::WasiSched">WasiSched</a>;</code></td></tr><tr><td><code>pub use table::<a class="struct" href="../wasi_common/table/struct.Table.html" title="struct wasi_common::table::Table">Table</a>;</code></td></tr></table><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<table><tr class="module-item"><td><a class="mod" href="clocks/index.html" title="wasi_common::clocks mod">clocks</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="mod" href="dir/index.html" title="wasi_common::dir mod">dir</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="mod" href="file/index.html" title="wasi_common::file mod">file</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="mod" href="pipe/index.html" title="wasi_common::pipe mod">pipe</a></td><td class="docblock-short"><p>Virtual pipes.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="random/index.html" title="wasi_common::random mod">random</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="mod" href="sched/index.html" title="wasi_common::sched mod">sched</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="mod" href="snapshots/index.html" title="wasi_common::snapshots mod">snapshots</a></td><td class="docblock-short"><p>One goal of <code>wasi-common</code> is for multiple WASI snapshots to provide an
interface to the same underlying <code>crate::WasiCtx</code>. This provides us a path
to evolve WASI by allowing the same WASI Command to import functions from
different snapshots - e.g. the user could use Rust’s <code>std</code> which imports
snapshot 1, but also depend directly on the <code>wasi</code> crate which imports
some future snapshot 2. Right now, this amounts to supporting snapshot 1
and “snapshot 0” aka wasi_unstable at once.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="table/index.html" title="wasi_common::table mod">table</a></td><td class="docblock-short"></td></tr></table><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.Error.html" title="wasi_common::Error struct">Error</a></td><td class="docblock-short"><p>The <code>Error</code> type, a wrapper around a dynamic error type.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.WasiCtx.html" title="wasi_common::WasiCtx struct">WasiCtx</a></td><td class="docblock-short"></td></tr></table><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<table><tr class="module-item"><td><a class="enum" href="enum.ErrorKind.html" title="wasi_common::ErrorKind enum">ErrorKind</a></td><td class="docblock-short"><p>Internal error type for the <code>wasi-common</code> crate.
Contains variants of the WASI <code>$errno</code> type are added according to what is actually used internally by
the crate. Not all values are represented presently.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.StringArrayError.html" title="wasi_common::StringArrayError enum">StringArrayError</a></td><td class="docblock-short"></td></tr></table><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<table><tr class="module-item"><td><a class="trait" href="trait.Context.html" title="wasi_common::Context trait">Context</a></td><td class="docblock-short"><p>Provides the <code>context</code> method for <code>Result</code>.</p>
</td></tr><tr class="module-item"><td><a class="trait" href="trait.ErrorExt.html" title="wasi_common::ErrorExt trait">ErrorExt</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="trait" href="trait.RngCore.html" title="wasi_common::RngCore trait">RngCore</a></td><td class="docblock-short"><p>The core of a random number generator.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="wasi_common" data-search-js="../search-index.js"></div>
    <script src="../main.js"></script></body></html>